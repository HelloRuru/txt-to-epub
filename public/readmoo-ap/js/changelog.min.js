function getChangelog(){const e=localStorage.getItem(CONFIG.STORAGE_KEYS.CHANGELOG);return e?JSON.parse(e):[]}function saveChangelog(e){localStorage.setItem(CONFIG.STORAGE_KEYS.CHANGELOG,JSON.stringify(e))}function addChangelogEntry(e,n){const t=getChangelog();t.unshift({id:"log_"+Date.now(),time:(new Date).toISOString(),user:AppState.user?.name||"匿名",type:e,content:n}),saveChangelog(t),document.getElementById("tab-changelog").classList.contains("active")&&renderChangelog()}function renderChangelog(e=""){const n=document.getElementById("changelog-list"),t=document.getElementById("changelog-empty");let a=getChangelog();e&&(a=a.filter(n=>n.time.startsWith(e))),t.style.display=0===a.length?"block":"none",n.style.display=0===a.length?"none":"flex";const g={add:"新增",edit:"編輯",delete:"刪除"};n.innerHTML=a.map(e=>{const n=new Date(e.time);return`\n      <div class="log-item">\n        <span class="log-time">${n.toLocaleDateString("zh-TW")+" "+n.toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"})}</span>\n        <span class="log-user">${escapeHtml(e.user)}</span>\n        <span class="log-content">\n          <span class="badge" style="font-size:11px;">${g[e.type]||e.type}</span>\n          ${escapeHtml(e.content)}\n        </span>\n      </div>\n    `}).join("")}function initChangelog(){const e=document.getElementById("changelog-date-filter");e.addEventListener("change",()=>{renderChangelog(e.value)}),renderChangelog()}window.initChangelog=initChangelog,window.addChangelogEntry=addChangelogEntry;