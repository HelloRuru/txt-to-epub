const QUIZ_ANSWERS={q1:"C",q2:"B"};function initQuiz(){const e=document.getElementById("identity-step"),t=document.getElementById("quiz-step"),n=document.getElementById("identity-select"),l=document.getElementById("btn-identity-confirm"),i=document.getElementById("btn-quiz-submit"),d=document.getElementById("quiz-error");let a="";function o(){n.innerHTML='<option value="">-- 選擇你的名字 --</option>',AppState.members.forEach(e=>{const t=document.createElement("option");t.value=e.name,t.textContent=`#${e.id} ${e.name}`,n.appendChild(t)})}function c(){e.style.display="block",t.style.display="none",d.style.display="none",n.value="",l.disabled=!0,document.querySelectorAll('input[name="q1"], input[name="q2"]').forEach(e=>e.checked=!1),a=""}n.addEventListener("change",()=>{l.disabled=!n.value}),l.addEventListener("click",()=>{a=n.value,a&&(e.style.display="none",t.style.display="block")}),i.addEventListener("click",()=>{const e=document.querySelector('input[name="q1"]:checked'),t=document.querySelector('input[name="q2"]:checked');if(!e||!t)return d.style.display="flex",void(d.querySelector("span").textContent="兩題都要選喔！");if(e.value===QUIZ_ANSWERS.q1&&t.value===QUIZ_ANSWERS.q2){const e=(new Date).toISOString().split("T")[0];saveUser(a,e),closeModal("quiz-modal"),showToast(`歡迎回來，${a}！`),c(),AppState._authCallback&&(AppState._authCallback(),AppState._authCallback=null)}else d.style.display="flex",d.querySelector("span").textContent="答案不正確，請再試一次。",document.querySelectorAll('input[name="q1"], input[name="q2"]').forEach(e=>e.checked=!1)}),document.getElementById("quiz-modal-close").addEventListener("click",c),o(),document.addEventListener("members-updated",o)}window.initQuiz=initQuiz;